## Function name: postprocess
## Arguments?: Yes, install name
## Purpose: Run the function. It will ask for an install name. Once provided, it will return the post-processing rules currently set in the database for that install. You must be on the pod of the install to run this. If you supply an install name, it will not ask you for one.

postprocess (){ red='\x1b[0;31m'; yellow='\x1b[0;33m'; green='\x1b[0;32m'; teal='\x1b[0;36m'; blue='\x1b[0;34m'; purple='\x1b[0;35m'; NC='\x1b[0m'; if [ $# -eq 0 ]; then echo -e "\n\nPlease provide the install name you would like to view the post-processing rules for: \n"; read install; else install=$1; fi; wpe $install; if [ $(grep "define('MULTISITE', true);" wp-config.php | grep -o true) == true ]; then pprules=$(db=$(grep -i db_name wp-config.php |awk -F"'" '{print $4}'); password=$(grep DB_PASSWORD wp-config.php | cut -d"'" -f4); user=$(grep DB_USER wp-config.php | cut -d"'" -f4); prefix=$(grep -i table_prefix wp-config.php |awk -F"'" '{print $2}'); table=$(echo "$prefix"options); cereal=$(mysql -u $user -p$password -e "use $db; SELECT meta_value FROM ${prefix}sitemeta WHERE meta_key LIKE '%post_process%'" 2>/dev/null | tail -n+2); echo -e "\n\n$cereal" | sed -r 's/\#\"\;s\:([0-9]*)\:\"/\#\ \=\>\ /g' | sed -r 's/(s*)\"\;s\:([0-9]*)\:\"/\n/g' | sed -r 's/a\:([0-9]*)\:\{s\:([0-9]*)\:\"//' | sed -r 's/\"\;\}$//' | grep -v '^$';); ppcount=$(echo "$pprules" | wc -l); echo -e "\n\n------------------------------------------------------------------\nI found ${yellow}$ppcount${NC} post-processing rules currently for install ${red}$(pwd | cut -d'/' -f5)${NC}.\n------------------------------------------------------------------\n\n"; echo "$pprules"; echo -e "\n\n"; else pprules=$(db=$(grep -i db_name wp-config.php |awk -F"'" '{print $4}'); password=$(grep DB_PASSWORD wp-config.php | cut -d"'" -f4); user=$(grep DB_USER wp-config.php | cut -d"'" -f4); prefix=$(grep -i table_prefix wp-config.php |awk -F"'" '{print $2}'); table=$(echo "$prefix"options); cereal=$(mysql -u $user -p$password -e "use $db; SELECT option_value FROM ${prefix}options WHERE option_name LIKE '%post_process%'" 2>/dev/null | tail -n+2); echo -e "\n\n$cereal" | sed -r 's/\#\"\;s\:([0-9]*)\:\"/\#\ \=\>\ /g' | sed -r 's/(s*)\"\;s\:([0-9]*)\:\"/\n/g' | sed -r 's/a\:([0-9]*)\:\{s\:([0-9]*)\:\"//' | sed -r 's/\"\;\}$//' | grep -v '^$';); ppcount=$(echo "$pprules" | wc -l); echo -e "\n\n------------------------------------------------------------------\nI found ${yellow}$ppcount${NC} post-processing rules currently for install ${red}$(pwd | cut -d'/' -f5)${NC}.\n------------------------------------------------------------------\n\n"; echo "$pprules"; echo -e "\n\n"; fi;}; postprocess
